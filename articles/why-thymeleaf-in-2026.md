---
title: "「そのSPA、本当に必要ですか？」— Thymeleafとhtmxで実現するモダンMPA開発"
emoji: "🍃"
type: "tech"
topics: ["java", "springboot", "thymeleaf", "htmx", "mpa"]
published: true
---

## 1. SPAが適している世界と、そうでない世界

まず最初に明確にしておきたいことがあります。
**SPAが不可欠なアプリケーションは確実に存在します。**

たとえば

- **Figma**: リアルタイムでの共同編集、無限キャンバス、複雑なベクター操作
- **Miro**: ホワイトボードの同時編集、ドラッグ&ドロップ、リアルタイム同期
- **Excel Online**: セルの即時更新、数式の再計算、マルチユーザー編集

これらに共通するのは

- **クライアント側で複雑な状態遷移が必要**
- **高頻度な部分更新が求められる**
- **リッチなインタラクションが本質的な価値**

こうしたアプリケーションでは、SPAアーキテクチャは合理的な選択です。少なくとも、MPAで構築するのは現実的ではありません。

本記事では、その一例として、Thymeleafを用いたMPA構成を軸に考察します。

## 2. その設計は本当に必要か？

次のようなアプリケーションを思い浮かべてください

- **会員向けマイページ**（注文履歴、設定変更）
- **社内管理画面**（ユーザー管理、データ検索）
- **フォーム中心の業務アプリ**（申請、承認、登録）

これらの特徴は

**主な操作**
- データの表示
- フォーム
- 保存ボタンのクリック

**状態の在り処**
- ほとんどがDBに永続化される
- クライアント側で保持すべき状態は少ない

**UI特性**
- ドラッグ&ドロップなし
- リアルタイム同時編集なし
- オフライン対応不要

このようなユースケースに、hydration（クライアント側での再構築処理）、状態同期、複雑なビルドパイプライン、クライアント/サーバー間のデータフェッチ管理は**本当に必要でしょうか？**

## 3. なぜSPAはここまで広がったのか

SPAの普及には正当な理由があります。

**jQuery時代の限界**

多くの現場では、Webアプリケーション開発は混沌としていた印象です。

- DOMを直接操作するjQueryコード
- グローバル変数だらけのスパゲッティJS
- 画面が複雑になるほど保守不可能に

**Angular/Reactがもたらした世界観**

- **UIの構造化**: コンポーネントという概念
- **状態管理**: データフローの明確化
- **部分更新**: 効率的なレンダリング

これは革命的でした。
開発者は、ついに「フロントエンド開発」という営みを構造化できるようになったのです。

**そして成功体験が、過度に拡張された。**

問題は、この成功体験が「あらゆるWebアプリケーション」に適用されるようになったことです。

- 複雑なUIで成功した → シンプルなUIでも使おう
- 大規模チームで機能した → 小規模でも導入しよう
- モダンだから → とりあえず採用

技術自体が悪いのではありません。
**成功体験が、適用範囲を超えて拡張されすぎたのではないでしょうか。**

## 4. RSCやSSRの流れは何を意味しているか

興味深いことに、最近のフロントエンド界隈では、次のような動きが活発です。

- **React Server Components (RSC)**
- **Server-Side Rendering (SSR)**
- **Islands Architecture**

これらは何を意味しているのでしょうか？

**クライアントに寄せすぎた重心を、サーバーに戻す試み**です。

Next.js App Routerは、デフォルトがサーバーコンポーネントになりました。Astro Islandsは、必要な部分だけをインタラクティブにします。

クライアント側で状態を持ちすぎることのコストが、改めて議論されるようになっています。

- 初期表示の遅さ
- hydrationのコスト
- SEOの難しさ
- デバッグの複雑さ

こうした課題に対する再評価が進んでいます。

## 5. ThymeleafによるMPAという現実的な選択肢

ここで、一度立ち止まって考えてみましょう。
Webの基本モデルに立ち返ると、そこには揺るぎないシンプルさがあります。

* **URL = 状態**（ブラウザの戻る/進むが自然に機能する）
* **HTML = 画面**（サーバーが完全な画面を返す）
* **POST/REDIRECT/GET = フロー**（フォーム送信後の二重送信防止）

### 「モダンMPA」という進化

「でも、MPAはページ遷移のたびに画面がチラつくし、UXが悪い」
そう思われるかもしれません。しかし、今は **[htmx](https://htmx.org/)** や **[Turbo](https://turbo.hotwired.dev/)** といったライブラリを組み合わせることで、**「SPAのような滑らかな部分更新」をMPAのまま実現できる時代**です。

htmxを使えば、次のようなコードで「ボタンを押した時だけ、特定の部分をサーバーから取得したHTMLで差し替える」ことが可能です。

```html
<button hx-get="/parts/user-list" hx-target="#user-table">
  // リストを更新
</button>
```

複雑なJavaScriptで状態を管理し、JSONをフェッチしてDOMを再構築する必要はありません。サーバー側（Thymeleaf）でフラグメントを返すだけでいいのです。

### ThymeleafによるMPAの利点

この「モダンなMPA」構成には、多くの現実的なメリットがあります。

* **認証・認可がシンプル**: サーバー側で完結し、セッションベースの堅牢な認証が自然に使える。
* **SEO・初期表示**: サーバーがHTMLを返すため、追加の設定なしで高速に応答でき、クローラにも解釈されやすい。
* **「Locality of Behavior」の維持**: ロジックがHTMLの近くにまとまり、コードの追いやすさが向上する。

強調したいのは、**これは「古い技術に戻る」のではない**ということです。
一周回って、Webのポテンシャルを最大限に活かしつつ、開発コストを最小化する **「螺旋的な進化」** なのです。


## 6. 長期運用という観点からの技術選択

Webアプリケーションは、一度リリースして終わりではありません。
特にエンタープライズ領域では、5年、10年と運用され続けます。

この時間軸で技術選択を見直すと、別の観点が浮かび上がります。

フロントエンドフレームワークの世界は進化が速く、設計パラダイムの転換も頻繁に起こります。
これは革新の源泉である一方、数年単位で移行コストが発生する可能性も意味します。

対して、Java / Spring のエコシステムは長期安定運用を前提とした文化が根付いています。

- LTSリリースの継続
- 後方互換性の重視
- 10年以上稼働するシステムの現実的存在

Thymeleafを含むこのスタックは、最先端の変化速度ではなく、長期保守性を重視する文脈に適しています。

これは優劣の問題ではなく、時間軸の違いによる適材適所です。

短期間で進化を取り込み続けるシステムと、長期間安定運用を求められるシステムでは、最適解は異なります。


## 7. それでもThymeleafによるMPAの弱点はある

特に、開発体験において

**UI部品の可視化が弱い**
- どんなボタンがあるのか、一覧で見られない
- 新しい画面を作るとき、既存のコンポーネントを探しづらい

**再利用が見えにくい**
- 同じようなフォームを作っているのに気づかない
- コードの重複が発生しやすい

**デザイナーやPMとの共有が難しい**
- 「このUIパーツを見せて」と言われても、アプリ全体を起動する必要がある
- ログインが必要な画面だと、さらに面倒

一方、**SPAの世界には「Storybook」という文化があります。**

コンポーネントをカタログとして一覧でき、パラメータを変えながらプレビューできる。デザイナーと開発者がUIパーツについて会話するための共通言語になっています。

**なぜJava/Thymeleaf界隈にはこういったツールが少ないのでしょうか？**

## 8. そこで作ったのが Thymeleaflet

ここからは、私が作成したツールを紹介します。


この課題に対する一つのアプローチとして作ったのが、**Thymeleaflet**です。

![Thymeleaflet](https://wamukat.github.io/thymeleaflet-spring-boot-starter/assets/thymeleaflet-logo.png)

https://wamukat.github.io/thymeleaflet-spring-boot-starter/index.ja.html

### 位置づけ

Thymeleafletは、**ThymeleafのフラグメントをStorybookのような「カタログ」として扱うための仕組み**です。
> **Thymeleaflet** という名前は、**Thymeleaf** と、小冊子を意味する **Leaflet** を掛け合わせたものです。 Thymeleafの部品（フラグメント）を、パラパラと眺めるカタログや小冊子のように扱いたい、という思いを込めています。（※地図ライブラリとは関係ありません）


### 何を解決するか

- フラグメント（UI部品）の一覧表示
- パラメータを変えながらのライブプレビュー
- 使用例の自動生成
- レスポンシブ確認

### なぜSpring Boot Starterなのか

依存関係を追加するだけで動くようにしたかったからです。

```xml
<dependency>
  <groupId>io.github.wamukat</groupId>
  <artifactId>thymeleaflet-spring-boot-starter</artifactId>
  <version>0.2.5</version>
</dependency>
```


これだけで、`http://localhost:8080/thymeleaflet` にアクセスすれば、フラグメントをスキャンし一覧表示します。

あなたの既存のプロジェクトに一切手を加える必要はありません。

ライブデモはこちら
https://demo-thymeleaflet.koyeb.app/thymeleaflet



### Storybookとの違い

Storybookは、コンポーネントを**JavaScriptで記述**します。

Thymeleafletは、**HTMLテンプレートに書かれたJavaDocコメント**を解析します。

```html
<!--
/**
 * ボタンコンポーネント (button)
 *
 * @param label {@code String} [required] ボタンのラベル
 * @param variant {@code String} [optional=primary] primary | secondary | danger
 * @example <div th:replace="~{components/button :: button(label='送信')}"></div>
 */
-->
<button th:fragment="button(label, variant)">
  [[${label}]]
</button>
```

つまり、**テンプレート自体がドキュメント**になります。

別ファイルでストーリーを管理することもできますが、基本的にはHTMLファイルだけで完結します。

Thymeleafletは、Thymeleafが大切にしている「ブラウザでそのまま開ける」という特性を壊しません。

テンプレートに記述するのは単なるHTMLコメント（Javadoc）です。ブラウザで直接開いた時は単なるコメントとして無視され、Thymeleafletを通した時だけ、それが生きたドキュメントとしてカタログ化されます。

これは、Natural Templateという思想を「コンポーネント時代」に合わせて拡張する試みでもあります。


## 9. MPAが向いているケース／向いていないケース

ツールの紹介を挟みましたが、本質は依然としてアーキテクチャ選択にあります。
改めて適用範囲を整理します。

### 向いている

- **会員向けサイト**: マイページ、設定画面、注文履歴
- **管理画面**: CRUD操作、データ検索、レポート表示
- **フォーム中心の業務アプリ**: 申請、承認、登録フロー
- **SEOが重要**: コーポレートサイト、ブログ、ECサイト

これらの共通点は、 **「ページ遷移が自然なユーザー体験」** であることです。

### 向いていない

- **リアルタイム同時編集**: Figma、Google Docs的なもの
- **高度にインタラクティブなUI**: ドラッグ&ドロップ、キャンバス操作
- **複雑なクライアント側状態**: 複数ステップのウィザードで、すべてがクライアントで完結
- **オフライン対応**: PWAとしての動作が必須

これらは、素直にSPAで作った方が良いでしょう。

**どちらが優れているかではなく、どちらが適切か、です。**

## 10. 結論：SPAかMPAかではない

この記事を通じて伝えたかったのは、「SPAかMPAか」という二項対立ではありません。

**問うべきは、「そのUIに、クライアント側で状態を持つ必然性があるか」です。**

### 問いかけ

- ページ遷移が不自然に感じるほど頻繁な部分更新が必要か？
- クライアント側でリアルタイムに同期すべき状態があるか？
- サーバーへのリクエストを減らすことが、本質的な価値か？

もしこれらの答えが「No」なら、MPAという選択肢を見直してもいいんじゃないかと思います。

- URLが状態を表す明快さ
- サーバーでHTMLを組み立てるシンプルさ
- デバッグのしやすさ
- SEOの容易さ

そして、Thymeleafletがあれば、**MPAでもモダンな開発体験**を得られます。

### 設計判断を取り戻す

技術選択は、流行やトレンドではなく、**要件と制約から導かれるべき**です。

- 「みんなSPAだから」
- 「モダンだから」
- 「履歴書に書けるから」

ではなく、

- 「このプロダクトには、この技術が適切だから」

と言えるようになりたい。

設計判断をフレームワークに委ねるのではなく、アーキテクチャレベルで選択する。
その視点を取り戻すことが、この記事の本当の目的です。

## 11. コミュニティへの問い

みなさんは、SPAとMPAをどう使い分けていますか？

- プロジェクトでの経験
- 技術選択の判断基準
- MPAで困ったこと
- SPAで不要だったと感じたこと

コメントやフィードバックをいただけると嬉しいです。


---

**リンク集**

- **紹介ページ**: @[card](https://wamukat.github.io/thymeleaflet-spring-boot-starter/)
- **ライブデモ**: @[card](https://demo-thymeleaflet.koyeb.app/thymeleaflet)
- **GitHub**: @[card](https://github.com/wamukat/thymeleaflet-spring-boot-starter)
- **Maven Central**: @[card](https://central.sonatype.com/artifact/io.github.wamukat/thymeleaflet-spring-boot-starter)

フィードバック、Issue、PRをお待ちしています。